# Agent Teams æ•ˆç‡æœ€å¤§åŒ–è§„åˆ™

> é€‚ç”¨èŒƒå›´ï¼šæ‰€æœ‰ Agent Teams ä¼šè¯ï¼ˆclaude-teams MCPï¼‰ï¼Œæ‰€æœ‰é¡¹ç›®
> çº§åˆ«ï¼šğŸ”¥ P0ï¼ˆå¼ºåˆ¶ï¼‰
> äº’è¡¥è§„åˆ™ï¼š[agent-model-routing.md](./agent-model-routing.md)ï¼ˆæ¨¡å‹è·¯ç”±ï¼‰ã€[agent-discipline.md](./agent-discipline.md)ï¼ˆæ‰§è¡Œçºªå¾‹ï¼‰

---

## 1. æ³¢æ¬¡è°ƒåº¦ï¼ˆP0 é“å¾‹ï¼‰

æ‰€æœ‰å¤šä»»åŠ¡æ‰§è¡Œ**å¿…é¡»**æŒ‰æ³¢æ¬¡ï¼ˆWaveï¼‰ç»„ç»‡ï¼Œç¦æ­¢ä¸€æ¬¡æ€§ spawn å…¨éƒ¨ agentã€‚

```
Wave 1: æ‰€æœ‰ç‹¬ç«‹ä»»åŠ¡ï¼ˆæ— å‰ç½®ä¾èµ–ï¼‰â†’ æœ€å¤§å¹¶è¡Œ
    â†“ è´¨é‡é—¨ç¦é€šè¿‡
Wave 2: ä¾èµ– Wave 1 äº§å‡ºçš„ä»»åŠ¡ â†’ å¹¶è¡Œ
    â†“ è´¨é‡é—¨ç¦é€šè¿‡
Wave N: ä¾èµ– Wave N-1 çš„ä»»åŠ¡ â†’ å¹¶è¡Œ
    â†“ æœ€ç»ˆè´¨é‡é—¨ç¦
å®Œæˆ
```

### 1.1 æ³¢æ¬¡è§„åˆ™

| è§„åˆ™ | çº¦æŸ | ç†ç”± |
|------|------|------|
| æ¯æ³¢æœ€å¤š 5 ä¸ª agent | è¶…è¿‡ 5 ä¸ª git å†²çªæ¦‚ç‡é™¡å¢ | å®æµ‹ç»éªŒ |
| æ³¢æ¬¡é—´å¿…é¡»è·‘è´¨é‡é—¨ç¦ | `fmt + clippy + test` | é˜²æ­¢é”™è¯¯çº§è” |
| åŒæ³¢ agent æ–‡ä»¶é›¶é‡å  | è§ Â§2 æ–‡ä»¶éš”ç¦» | æ¶ˆé™¤åˆå¹¶å†²çª |
| é•¿é“¾ä»»åŠ¡ä¼˜å…ˆå¯åŠ¨ | å…³é”®è·¯å¾„å†³å®šæ€»è€—æ—¶ | å‡å°‘å¢™é’Ÿæ—¶é—´ |

### 1.2 ä¾èµ–å›¾æ„å»º

spawn å‰**å¿…é¡»**ç”»å‡ºä»»åŠ¡ä¾èµ–å›¾ï¼Œè¯†åˆ«ï¼š

- ç‹¬ç«‹ä»»åŠ¡ï¼ˆç«‹å³å¹¶è¡Œï¼‰
- ä¾èµ–é“¾ï¼ˆä¸²è¡Œä¸å¯å‹ç¼©ï¼‰
- å…³é”®è·¯å¾„ï¼ˆå†³å®šæ€»è€—æ—¶çš„æœ€é•¿é“¾ï¼‰

```
# ç¤ºä¾‹ï¼šè¯†åˆ«ä¸‰ç±»ä»»åŠ¡
ç‹¬ç«‹: T01, T03, T04, T09  â†’ Wave 1ï¼ˆå…¨éƒ¨å¹¶è¡Œï¼‰
ä¾èµ–: T03 â†’ T02 â†’ T08    â†’ Wave 1(T03) â†’ Wave 2(T02) â†’ Wave 3(T08)
å…³é”®è·¯å¾„: T03â†’T02â†’T08â†’T14 = 8.5hï¼ˆä¸å¯å‹ç¼©ï¼‰
```

---

## 2. æ–‡ä»¶éš”ç¦»ï¼ˆP0 é“å¾‹ï¼‰

### 2.1 Crate çº§éš”ç¦»ï¼ˆæ¨èï¼‰

æ¯ä¸ª agent æ‹¥æœ‰**æ•´ä¸ª crate** çš„ç‹¬å å†™æƒé™ï¼Œç²’åº¦ä¸º crate è€Œéæ–‡ä»¶ã€‚

```
Agent A: crates/common/src/error/ + crates/common/src/secure/
Agent B: crates/etcd/ + crates/taos/ + crates/rabbitmq/
Agent C: crates/common/src/health/ + crates/common/src/middleware/
```

### 2.2 éš”ç¦»é“å¾‹

| è§„åˆ™ | è¿è§„åæœ |
|------|---------|
| ä¸€ä¸ªæ–‡ä»¶åªèƒ½æœ‰ä¸€ä¸ª owner | è¿è§„ agent çš„æ”¹åŠ¨è¢« revert |
| å…±äº«æ–‡ä»¶ï¼ˆCargo.toml/lib.rsï¼‰ç”± Team Lead ä¸²è¡Œä¿®æ”¹ | ç¦æ­¢ agent ç›´æ¥æ”¹ workspace çº§æ–‡ä»¶ |
| æ–°å»ºæ–‡ä»¶å¿…é¡»åœ¨ ownership è¾¹ç•Œå†… | è¶Šç•Œæ–‡ä»¶ä¸åˆå¹¶ |
| æ¥å£å¥‘çº¦ï¼ˆtrait ç­¾åï¼‰ä¸å¯å•æ–¹é¢ä¿®æ”¹ | éœ€ Team Lead åè°ƒ |

### 2.3 äº’æ–¥èµ„æº

ä»¥ä¸‹èµ„æºéœ€è¦æ’ä»–é”ï¼ŒåŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ª agent æ“ä½œï¼š

- `Cargo.toml`ï¼ˆworkspace çº§ï¼‰
- `Cargo.lock`
- `cargo test`ï¼ˆå…¨ workspaceï¼‰
- `cargo build`ï¼ˆå…¨ workspaceï¼‰

---

## 3. Agent åˆ†ç»„ç­–ç•¥ï¼ˆP0ï¼‰

### 3.1 æŒ‰æ”¹åŠ¨åŸŸåˆ†ç»„

å°†ä»»åŠ¡æŒ‰**æ¶‰åŠçš„ crate / ç›®å½•**åˆ†ç»„ï¼ŒåŒç»„ä»»åŠ¡åˆ†é…ç»™åŒä¸€ agentã€‚

```
# å¥½ï¼šåŒåŸŸèšåˆ
Agent A: T01(common/error) + T03(common/secure)  â†’ åŒä¸€ crate å­ç›®å½•
Agent B: T04(taos) + T09(common/Cargo.toml)       â†’ ä¸åŒ crateï¼Œé›¶é‡å 

# åï¼šè·¨åŸŸåˆ†æ•£
Agent A: T01(common/error) + T05(common/health)   â†’ åŒ crate ä¸åŒå­ç›®å½•ï¼Œå¯èƒ½å†²çª
```

### 3.2 åˆ†ç»„ä¼˜å…ˆçº§

1. **æ–‡ä»¶é›¶é‡å ** â€” æœ€é«˜ä¼˜å…ˆï¼Œä¸å¯å¦¥å
2. **è¯­ä¹‰ç›¸å…³** â€” ç›¸å…³ä»»åŠ¡åˆå¹¶å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢
3. **å·¥ä½œé‡å‡è¡¡** â€” å„ agent é¢„ä¼°å·¥æ—¶å·®è· â‰¤ 2x

---

## 4. Team Lead èŒè´£ï¼ˆP0ï¼‰

Team Leadï¼ˆä¸» Agentï¼‰**åªåšåè°ƒï¼Œä¸åšå®ç°**ï¼š

| èŒè´£ | åŠ¨ä½œ |
|------|------|
| åˆ†æä¾èµ–å›¾ | ç”»å‡ºä»»åŠ¡ä¾èµ–å…³ç³»ï¼Œè¯†åˆ«å…³é”®è·¯å¾„ |
| åˆ’åˆ†æ³¢æ¬¡ | æŒ‰ä¾èµ–å…³ç³»åˆ†æ³¢ï¼Œæ¯æ³¢ â‰¤ 5 agent |
| åˆ†é…æ–‡ä»¶æ‰€æœ‰æƒ | ç¡®ä¿é›¶é‡å ï¼Œå…±äº«æ–‡ä»¶è‡ªå·±ä¸²è¡Œå¤„ç† |
| spawn + åˆ†å‘ä»»åŠ¡ | æ¯ä¸ª agent çš„ prompt åŒ…å«ï¼šä»»åŠ¡æè¿° + æ–‡ä»¶æ‰€æœ‰æƒæ¸…å• + éªŒæ”¶æ ‡å‡† |
| æ³¢æ¬¡é—´è´¨é‡é—¨ç¦ | `cargo fmt --check && cargo clippy --all-targets -- -D warnings && cargo test` |
| åˆå¹¶ç»“æœ | æ¯æ³¢ç»“æŸååˆå¹¶å„ agent çš„æ”¹åŠ¨åˆ°ä¸»åˆ†æ”¯ |
| å¤„ç†å†²çª | å…±äº«æ–‡ä»¶çš„ä¿®æ”¹ç”± Lead ç»Ÿä¸€æ‰§è¡Œ |

### 4.1 spawn_teammate prompt æ¨¡æ¿

æ¯ä¸ª teammate çš„ prompt **å¿…é¡»**åŒ…å«ä»¥ä¸‹ç»“æ„ï¼š

```
## ä»»åŠ¡
{ä»»åŠ¡æè¿°ï¼Œ1-3 å¥}

## æ–‡ä»¶æ‰€æœ‰æƒ
ä½ åªèƒ½ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶/ç›®å½•ï¼š
- {path1}
- {path2}
ç¦æ­¢ä¿®æ”¹å…¶ä»–ä»»ä½•æ–‡ä»¶ã€‚éœ€è¦æ”¹å…±äº«æ–‡ä»¶æ—¶ï¼Œé€šè¿‡ send_message é€šçŸ¥ team-leadã€‚

## éªŒæ”¶æ ‡å‡†
- {æ ‡å‡†1}
- {æ ‡å‡†2}

## è´¨é‡è¦æ±‚
å®Œæˆåè¿è¡Œï¼šcargo fmt --check && cargo clippy --all-targets -- -D warnings && cargo test -p {crate}
å…¨éƒ¨é€šè¿‡åï¼Œé€šè¿‡ send_message æŠ¥å‘Šå®Œæˆã€‚
```

---

## 5. è´¨é‡é—¨ç¦ï¼ˆP0ï¼‰

### 5.1 æ³¢æ¬¡é—´é—¨ç¦

æ¯æ³¢ç»“æŸåï¼ŒTeam Lead **å¿…é¡»**æ‰§è¡Œï¼š

```bash
cargo fmt --check
cargo clippy --all-targets -- -D warnings
cargo test --workspace
```

å…¨éƒ¨é€šè¿‡æ‰èƒ½å¯åŠ¨ä¸‹ä¸€æ³¢ã€‚ä»»ä½•å¤±è´¥å¿…é¡»åœ¨å½“å‰æ³¢ä¿®å¤ã€‚

### 5.2 Agent çº§é—¨ç¦

æ¯ä¸ª agent å®Œæˆä»»åŠ¡åï¼Œ**å¿…é¡»**å¯¹è‡ªå·±æ¶‰åŠçš„ crate æ‰§è¡Œï¼š

```bash
cargo fmt --check -p {crate}
cargo clippy -p {crate} -- -D warnings
cargo test -p {crate}
```

---

## 6. å›¢é˜Ÿç”Ÿå‘½å‘¨æœŸï¼ˆP0ï¼‰

### 6.1 åˆ›å»º

```
team_create â†’ spawn_teammate Ã— N â†’ task_create Ã— N â†’ å¼€å§‹å·¥ä½œ
```

- å›¢é˜Ÿåç§°å¿…é¡»è¯­ä¹‰åŒ–ï¼ˆå¦‚ `infra-v11-wave1`ï¼‰ï¼Œç¦æ­¢éšæœºå
- æ¯ä¸ª teammate çš„ `model` ç»Ÿä¸€ä½¿ç”¨ **opus**ï¼Œä¸åšæˆæœ¬åˆ†çº§

### 6.2 æ³¢æ¬¡é—´ä¸Šä¸‹æ–‡ä¼ é€’

Wave 2 çš„ agent **å¿…é¡»**åœ¨ prompt ä¸­åŒ…å« Wave 1 çš„å…³é”®äº§å‡ºæ‘˜è¦ï¼š

```
## å‰åºæ³¢æ¬¡ç»“æœ
Wave 1 å·²å®Œæˆä»¥ä¸‹æ”¹åŠ¨ï¼ˆä½ çš„ä»»åŠ¡ä¾èµ–è¿™äº›ç»“æœï¼‰ï¼š
- Agent A: {æ”¹åŠ¨æ‘˜è¦ï¼Œ1-2 å¥}ï¼Œæ¶‰åŠæ–‡ä»¶ï¼š{file1, file2}
- Agent B: {æ”¹åŠ¨æ‘˜è¦ï¼Œ1-2 å¥}ï¼Œæ¶‰åŠæ–‡ä»¶ï¼š{file3, file4}

## ä½ çš„ä»»åŠ¡
{åŸºäºä¸Šè¿°ç»“æœçš„æ–°ä»»åŠ¡æè¿°}
```

ç¦æ­¢è®© Wave 2 agent è‡ªè¡Œæ¢ç´¢ Wave 1 åšäº†ä»€ä¹ˆâ€”â€”è¿™æµªè´¹ä¸Šä¸‹æ–‡çª—å£ä¸”å®¹æ˜“é—æ¼ã€‚

### 6.3 é”€æ¯ä¸æ¸…ç†

æ¯æ³¢ç»“æŸåï¼ŒTeam Lead **å¿…é¡»**æ‰§è¡Œæ¸…ç†ï¼š

```
1. ç¡®è®¤æ‰€æœ‰ agent å·²æŠ¥å‘Šå®Œæˆæˆ–å¤±è´¥
2. send_message(type="shutdown_request") ç»™æ¯ä¸ª agent
3. ç­‰å¾… shutdown_approved å“åº”
4. process_shutdown_approved æ¸…ç†é…ç½®
5. è¶…æ—¶ 60s æœªå“åº” â†’ force_kill_teammate
6. éªŒè¯ï¼šread_config ç¡®è®¤æˆå‘˜åˆ—è¡¨ä¸ºç©º
```

ç¦æ­¢ä»¥ä¸‹è¡Œä¸ºï¼š
- ä¸æ¸…ç†å°±å¯åŠ¨ä¸‹ä¸€æ³¢ï¼ˆtmux æ®‹ç•™ä¼šè€—å°½èµ„æºï¼‰
- è·¨æ³¢å¤ç”¨ agentï¼ˆä¸Šä¸‹æ–‡æ±¡æŸ“ï¼Œä¸å¦‚é‡æ–° spawnï¼‰
- å›¢é˜Ÿå®Œæˆåä¸åˆ é™¤ï¼ˆ`team_delete` é‡Šæ”¾èµ„æºï¼‰

---

## 7. é€šä¿¡çºªå¾‹ï¼ˆP0ï¼‰

| åœºæ™¯ | æ–¹å¼ | ç¦æ­¢ |
|------|------|------|
| ä»»åŠ¡å®ŒæˆæŠ¥å‘Š | `task_update` æ ‡è®°å®Œæˆ + `send_message` ç»™ lead | åªæ ‡è®°ä¸é€šçŸ¥ |
| é‡åˆ°é˜»å¡ | `send_message` ç»™ leadï¼Œè¯´æ˜é˜»å¡åŸå›  | é™é»˜ç­‰å¾… |
| éœ€è¦æ”¹å…±äº«æ–‡ä»¶ | `send_message` ç»™ lead è¯·æ±‚ | ç›´æ¥ä¿®æ”¹ |
| å…¨é˜Ÿé€šçŸ¥ | ä»… Team Lead å¯ `broadcast` | agent ä¹‹é—´ broadcast |
| è¿›åº¦æŸ¥è¯¢ | `task_list` + `task_get` | è½®è¯¢ inbox |

---

## 8. å¤±è´¥å¤„ç†ï¼ˆP1ï¼‰

### 8.1 Agent å¤±è´¥

```
Agent æŠ¥å‘Šå¤±è´¥
    â†“
Team Lead è¯„ä¼°ï¼šä»»åŠ¡å¯é‡è¯•ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ åŒä¸€ agent é‡è¯• 1 æ¬¡
    â”œâ”€ å¦ â†’ æ¢æ–¹æ³•æˆ–ç¼©å°èŒƒå›´åé‡æ–°åˆ†é…
    â””â”€ 3 æ¬¡å¤±è´¥ â†’ æ ‡è®°ä¸º blockedï¼Œä¸ŠæŠ¥ç”¨æˆ·
```

### 8.2 æ³¢æ¬¡å¤±è´¥

```
è´¨é‡é—¨ç¦å¤±è´¥
    â†“
å®šä½å¤±è´¥ agent çš„æ”¹åŠ¨
    â”œâ”€ å¯å¿«é€Ÿä¿®å¤ â†’ ä¿®å¤åé‡è·‘é—¨ç¦
    â””â”€ ä¸å¯å¿«é€Ÿä¿®å¤ â†’ revert è¯¥ agent æ”¹åŠ¨ï¼Œç¼©å°èŒƒå›´é‡æ¥
```

---

## 9. æ•ˆç‡åº¦é‡ï¼ˆP2ï¼‰

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | ç›®æ ‡ |
|------|---------|------|
| å¹¶è¡ŒåŠ é€Ÿæ¯” | ä¸²è¡Œæ€»è€—æ—¶ / å®é™…å¢™é’Ÿæ—¶é—´ | â‰¥ 2x |
| æ³¢æ¬¡åˆ©ç”¨ç‡ | å®é™… agent æ•° / æ¯æ³¢ä¸Šé™(5) | â‰¥ 60% |
| å†²çªç‡ | åˆå¹¶å†²çªæ¬¡æ•° / æ€» agent æ•° | 0% |
| ä¸€æ¬¡é€šè¿‡ç‡ | é—¨ç¦ä¸€æ¬¡é€šè¿‡çš„æ³¢æ¬¡ / æ€»æ³¢æ¬¡ | â‰¥ 80% |
| å…³é”®è·¯å¾„å æ¯” | å…³é”®è·¯å¾„è€—æ—¶ / æ€»å¢™é’Ÿæ—¶é—´ | â‰¤ 50% |
